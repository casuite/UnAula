<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#E8F4FD">
    <title>C√°tedra Abierta Suite - Sistema de Gesti√≥n Docente</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-bg: #F8FAFC;
            --secondary-bg: #E8F4FD;
            --accent-bg: #FFF2E8;
            --card-bg: #FFFFFF;
            --text-primary: #2D3748;
            --text-secondary: #4A5568;
            --text-muted: #718096;
            --border-light: #E2E8F0;
            --border-medium: #CBD5E0;
            --success: #68D391;
            --warning: #F6E05E;
            --error: #FC8181;
            --info: #63B3ED;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header Styles */
        .app-header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem 2rem;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--info) 0%, var(--success) 100%);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .app-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--secondary-bg);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--success);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .login-card {
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: 3rem;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--info) 0%, var(--success) 100%);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 24px;
            margin: 0 auto 2rem;
        }
        
        .login-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .login-subtitle {
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            min-height: 44px;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--info) 0%, var(--success) 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
        }
        
        .btn-secondary:hover {
            background: var(--secondary-bg);
            border-color: var(--border-medium);
        }
        
        .btn-google {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-medium);
            width: 100%;
            font-size: 1rem;
            padding: 1rem;
        }
        
        .btn-google:hover {
            background: var(--primary-bg);
            box-shadow: var(--shadow-md);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            min-height: 36px;
        }
        
        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
            min-height: 52px;
        }
        
        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            overflow: hidden;
        }
        
        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            background: var(--primary-bg);
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        /* Menu Items */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .menu-item {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: inherit;
        }
        
        .menu-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--info);
        }
        
        .menu-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 1rem;
        }
        
        .menu-icon.classrooms { background: linear-gradient(135deg, #E8F4FD 0%, #B3E5FC 100%); }
        .menu-icon.attendance { background: linear-gradient(135deg, #FFF2E8 0%, #FFE0B2 100%); }
        .menu-icon.reports { background: linear-gradient(135deg, #F0FFF4 0%, #C8E6C9 100%); }
        .menu-icon.settings { background: linear-gradient(135deg, #FFF0F5 0%, #F8BBD9 100%); }
        
        .menu-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .menu-description {
            color: var(--text-muted);
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        /* Tables */
        .table-container {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background: var(--primary-bg);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-light);
            font-size: 0.875rem;
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-light);
            color: var(--text-secondary);
        }
        
        .table tbody tr:hover {
            background: var(--primary-bg);
        }
        
        .table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 0.875rem;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.2s ease;
            min-height: 44px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--info);
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.1);
        }
        
        /* Status Indicators */
        .status-present { color: var(--success); font-weight: 600; }
        .status-absent { color: var(--error); font-weight: 600; }
        .status-late { color: var(--warning); font-weight: 600; }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-success { background: rgba(104, 211, 145, 0.1); color: var(--success); }
        .badge-warning { background: rgba(246, 224, 94, 0.1); color: #D69E2E; }
        .badge-error { background: rgba(252, 129, 129, 0.1); color: var(--error); }
        .badge-info { background: rgba(99, 179, 237, 0.1); color: var(--info); }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        /* Attendance Controls */
        .attendance-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .attendance-btn {
            padding: 2rem;
            border: none;
            border-radius: var(--radius-lg);
            font-family: inherit;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 80px;
            color: white;
        }
        
        .attendance-btn.present {
            background: linear-gradient(135deg, var(--success) 0%, #48BB78 100%);
        }
        
        .attendance-btn.absent {
            background: linear-gradient(135deg, var(--error) 0%, #E53E3E 100%);
        }
        
        .attendance-btn.late {
            background: linear-gradient(135deg, var(--warning) 0%, #D69E2E 100%);
            color: var(--text-primary);
        }
        
        .attendance-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-light);
            border-top: 2px solid var(--info);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.75rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-header {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .login-card {
                padding: 2rem;
                margin: 1rem;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .menu-item {
                padding: 1.5rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .attendance-controls {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                overflow-x: auto;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .user-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        
        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-container">
            <div class="login-card fade-in">
                <div class="login-logo">CA</div>
                <h1 class="login-title">C√°tedra Abierta Suite</h1>
                <p class="login-subtitle">Sistema de Gesti√≥n Docente Moderno</p>
                
                <div id="g_id_onload"
                     data-client_id="YOUR_GOOGLE_CLIENT_ID"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                
                <div id="g_id_signin" 
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="sign_in_with"
                     data-shape="rectangular"
                     data-logo_alignment="left"
                     class="btn-google">
                </div>
                
                <div style="margin: 1.5rem 0; position: relative;">
                    <div style="height: 1px; background: var(--border-light);"></div>
                    <span style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--card-bg); padding: 0 1rem; color: var(--text-muted); font-size: 0.875rem;">o contin√∫a con</span>
                </div>
                
                <div class="form-group">
                    <input type="text" id="username" class="form-input" placeholder="Nombre de usuario" autocomplete="username">
                </div>
                
                <button class="btn btn-primary" onclick="loginWithUsername()" style="width: 100%; margin-bottom: 1rem;">
                    Ingresar
                </button>
                
                <p style="color: var(--text-muted); font-size: 0.8rem; line-height: 1.4;">
                    Al continuar, aceptas nuestros t√©rminos de servicio y pol√≠tica de privacidad.
                </p>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" class="hidden">
            <!-- Header -->
            <header class="app-header">
                <div class="header-content">
                    <div class="logo-section">
                        <div class="logo">CA</div>
                        <div>
                            <div class="app-title">C√°tedra Abierta Suite</div>
                        </div>
                    </div>
                    
                    <div class="user-section">
                        <div class="user-info">
                            <div class="user-avatar" id="userAvatar">U</div>
                            <span id="currentUser">Usuario</span>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="logout()">
                            Salir
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard -->
                <div id="dashboard">
                    <div class="fade-in">
                        <h2 style="margin-bottom: 2rem; color: var(--text-primary);">Panel de Control</h2>
                        
                        <!-- Stats -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalClassrooms">0</div>
                                <div class="stat-label">Aulas Activas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalStudents">0</div>
                                <div class="stat-label">Estudiantes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="attendanceToday">0</div>
                                <div class="stat-label">Asistencias Hoy</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="averageAttendance">0%</div>
                                <div class="stat-label">Promedio Asistencia</div>
                            </div>
                        </div>
                        
                        <!-- Menu -->
                        <div class="menu-grid">
                            <div class="menu-item" onclick="showClassrooms()">
                                <div class="menu-icon classrooms">üè´</div>
                                <div class="menu-title">Gesti√≥n de Aulas</div>
                                <div class="menu-description">Administra aulas, estudiantes y configuraciones acad√©micas</div>
                            </div>
                            
                            <div class="menu-item" onclick="showAttendance()">
                                <div class="menu-icon attendance">üìã</div>
                                <div class="menu-title">Control de Asistencia</div>
                                <div class="menu-description">Registra y gestiona la asistencia de estudiantes</div>
                            </div>
                            
                            <div class="menu-item" onclick="showReports()">
                                <div class="menu-icon reports">üìä</div>
                                <div class="menu-title">Informes y Reportes</div>
                                <div class="menu-description">Genera reportes detallados y estad√≠sticas</div>
                            </div>
                            
                            <div class="menu-item" onclick="showSettings()">
                                <div class="menu-icon settings">‚öôÔ∏è</div>
                                <div class="menu-title">Configuraci√≥n</div>
                                <div class="menu-description">Personaliza el sistema seg√∫n tus necesidades</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Classrooms Section -->
                <div id="classroomsSection" class="hidden">
                    <div class="fade-in">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: var(--text-primary);">Gesti√≥n de Aulas</h2>
                            <div>
                                <button class="btn btn-primary" onclick="showAddClassroom()">
                                    + Nueva Aula
                                </button>
                                <button class="btn btn-secondary" onclick="showDashboard()">
                                    Volver
                                </button>
                            </div>
                        </div>
                        
                        <div id="classroomsList">
                            <!-- Classrooms will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Classroom Detail -->
                <div id="classroomDetail" class="hidden">
                    <div class="fade-in">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h2 id="classroomTitle" style="color: var(--text-primary);">Detalle del Aula</h2>
                                <p id="classroomSubtitle" style="color: var(--text-muted);"></p>
                            </div>
                            <div>
                                <button class="btn btn-primary btn-sm" onclick="showAddStudent()">
                                    + Estudiante
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="showClassrooms()">
                                    Volver
                                </button>
                            </div>
                        </div>
                        
                        <!-- Classroom Stats -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="classroomStudentCount">0</div>
                                <div class="stat-label">Total Estudiantes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="classroomApproved">0</div>
                                <div class="stat-label">TEA (‚â•7)</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="classroomAttendance">0%</div>
                                <div class="stat-label">Asistencia Promedio</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="classroomRepeaters">0</div>
                                <div class="stat-label">Recursantes</div>
                            </div>
                        </div>
                        
                        <!-- Students Table -->
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Estudiante</th>
                                        <th>Estado</th>
                                        <th>Asistencia</th>
                                        <th>Promedio</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                    <!-- Students will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Attendance Section -->
                <div id="attendanceSection" class="hidden">
                    <div class="fade-in">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: var(--text-primary);">Control de Asistencia</h2>
                            <button class="btn btn-secondary" onclick="showDashboard()">
                                Volver
                            </button>
                        </div>
                        
                        <div id="attendanceClassroomSelect">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Seleccionar Aula</h3>
                                </div>
                                <div class="card-content">
                                    <div id="attendanceClassroomsList">
                                        <!-- Classrooms for attendance will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Individual Attendance -->
                <div id="individualAttendance" class="hidden">
                    <div class="fade-in">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h2 style="color: var(--text-primary);">Tomando Asistencia</h2>
                                <p id="attendanceInfo" style="color: var(--text-muted);"></p>
                            </div>
                            <div>
                                <span id="attendanceProgress" class="badge badge-info">0/0</span>
                                <button class="btn btn-secondary btn-sm" onclick="cancelAttendance()">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                        
                        <div class="card text-center" style="padding: 3rem;">
                            <h3 id="currentStudentName" style="font-size: 2rem; margin-bottom: 2rem; color: var(--text-primary);">
                                Estudiante
                            </h3>
                            
                            <div class="attendance-controls">
                                <button class="attendance-btn present" onclick="markAttendance('P')">
                                    ‚úì PRESENTE
                                </button>
                                <button class="attendance-btn absent" onclick="markAttendance('A')">
                                    ‚úó AUSENTE
                                </button>
                                <button class="attendance-btn late" onclick="markAttendance('T')">
                                    ‚è∞ TARDE
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reportsSection" class="hidden">
                    <div class="fade-in">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: var(--text-primary);">Informes y Reportes</h2>
                            <button class="btn btn-secondary" onclick="showDashboard()">
                                Volver
                            </button>
                        </div>
                        
                        <div class="menu-grid">
                            <div class="menu-item" onclick="generateStudentReport()">
                                <div class="menu-icon reports">üë•</div>
                                <div class="menu-title">Reporte de Estudiantes</div>
                                <div class="menu-description">Lista completa de estudiantes por aula</div>
                            </div>
                            
                            <div class="menu-item" onclick="generateAttendanceReport()">
                                <div class="menu-icon reports">üìä</div>
                                <div class="menu-title">Reporte de Asistencia</div>
                                <div class="menu-description">Estad√≠sticas detalladas de asistencia</div>
                            </div>
                            
                            <div class="menu-item" onclick="generateGradeReport()">
                                <div class="menu-icon reports">üìà</div>
                                <div class="menu-title">Reporte de Calificaciones</div>
                                <div class="menu-description">An√°lisis de rendimiento acad√©mico</div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let currentUserData = null;
        let currentClassroom = null;
        let currentAttendanceSession = null;
        
        // Sample Data Structure (will be replaced with real data)
        let appData = {
            users: {},
            classrooms: [],
            students: [],
            attendance: {},
            settings: {}
        };

        // Initialize Google Sign-In
        function initializeGoogleAuth() {
            // This would be replaced with your actual Google Client ID
            // For demo purposes, we'll simulate the Google auth
            console.log('Google Auth initialized');
        }

        // Handle Google Sign-In Response
        function handleCredentialResponse(response) {
            try {
                // Decode the JWT token (in real implementation)
                const userData = parseJWT(response.credential);
                
                currentUser = {
                    id: userData.sub,
                    name: userData.name,
                    email: userData.email,
                    picture: userData.picture
                };
                
                loginUser(currentUser);
            } catch (error) {
                console.error('Error handling Google sign-in:', error);
                showError('Error al iniciar sesi√≥n con Google');
            }
        }

        // Parse JWT Token (simplified version)
        function parseJWT(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (error) {
                throw new Error('Invalid token');
            }
        }

        // Username Login
        function loginWithUsername() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                showError('Por favor ingrese un nombre de usuario');
                return;
            }
            
            // Create user object for username login
            currentUser = {
                id: 'user_' + username.toLowerCase(),
                name: username,
                email: username + '@local.system',
                picture: null,
                loginType: 'username'
            };
            
            loginUser(currentUser);
        }

        // Login User
        function loginUser(user) {
            currentUser = user;
            
            // Load or create user data
            loadUserData(user.id);
            
            // Update UI
            updateUserInterface();
            
            // Show main app
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Initialize dashboard
            showDashboard();
            
            console.log('User logged in:', user);
        }

        // Load User Data
        function loadUserData(userId) {
            const savedData = localStorage.getItem(`casuiteData_${userId}`);
            
            if (savedData) {
                try {
                    currentUserData = JSON.parse(savedData);
                } catch (error) {
                    console.error('Error loading user data:', error);
                    currentUserData = createDefaultUserData();
                }
            } else {
                currentUserData = createDefaultUserData();
            }
            
            // Merge with app data
            appData = { ...appData, ...currentUserData };
        }

        // Create Default User Data
        function createDefaultUserData() {
            return {
                classrooms: [
                    {
                        id: 1,
                        name: '1¬∞A',
                        school: 'Colegio San Mart√≠n',
                        shift: 'Ma√±ana',
                        classroomCode: 'abc123',
                        classroomLink: 'https://classroom.google.com/c/abc123'
                    },
                    {
                        id: 2,
                        name: '2¬∞B',
                        school: 'Instituto Belgrano',
                        shift: 'Tarde',
                        classroomCode: 'def456',
                        classroomLink: 'https://classroom.google.com/c/def456'
                    }
                ],
                students: [
                    {
                        id: 1,
                        name: 'Juan',
                        lastName: 'P√©rez',
                        classroomId: 1,
                        isRepeater: false,
                        average: 8.5
                    },
                    {
                        id: 2,
                        name: 'Mar√≠a',
                        lastName: 'Garc√≠a',
                        classroomId: 1,
                        isRepeater: false,
                        average: 9.2
                    },
                    {
                        id: 3,
                        name: 'Carlos',
                        lastName: 'Rodr√≠guez',
                        classroomId: 2,
                        isRepeater: true,
                        average: 6.8
                    }
                ],
                attendance: {},
                settings: {
                    theme: 'light',
                    language: 'es',
                    notifications: true
                }
            };
        }

        // Save User Data
        function saveUserData() {
            if (!currentUser) return;
            
            try {
                const dataToSave = {
                    classrooms: appData.classrooms,
                    students: appData.students,
                    attendance: appData.attendance,
                    settings: appData.settings
                };
                
                localStorage.setItem(`casuiteData_${currentUser.id}`, JSON.stringify(dataToSave));
                console.log('User data saved successfully');
            } catch (error) {
                console.error('Error saving user data:', error);
                showError('Error al guardar los datos');
            }
        }

        // Update User Interface
        function updateUserInterface() {
            if (!currentUser) return;
            
            // Update user info in header
            document.getElementById('currentUser').textContent = currentUser.name;
            
            // Update user avatar
            const avatar = document.getElementById('userAvatar');
            if (currentUser.picture) {
                avatar.innerHTML = `<img src="${currentUser.picture}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%;">`;
            } else {
                avatar.textContent = currentUser.name.charAt(0).toUpperCase();
            }
        }

        // Navigation Functions
        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboard').classList.remove('hidden');
            updateDashboardStats();
        }

        function showClassrooms() {
            hideAllSections();
            document.getElementById('classroomsSection').classList.remove('hidden');
            loadClassroomsList();
        }

        function showClassroomDetail(classroomId) {
            hideAllSections();
            document.getElementById('classroomDetail').classList.remove('hidden');
            loadClassroomDetail(classroomId);
        }

        function showAttendance() {
            hideAllSections();
            document.getElementById('attendanceSection').classList.remove('hidden');
            loadAttendanceClassrooms();
        }

        function showReports() {
            hideAllSections();
            document.getElementById('reportsSection').classList.remove('hidden');
        }

        function hideAllSections() {
            const sections = ['dashboard', 'classroomsSection', 'classroomDetail', 'attendanceSection', 'individualAttendance', 'reportsSection'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
        }

        // Dashboard Functions
        function updateDashboardStats() {
            const totalClassrooms = appData.classrooms.length;
            const totalStudents = appData.students.length;
            const attendanceToday = calculateTodayAttendance();
            const averageAttendance = calculateAverageAttendance();
            
            document.getElementById('totalClassrooms').textContent = totalClassrooms;
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('attendanceToday').textContent = attendanceToday;
            document.getElementById('averageAttendance').textContent = averageAttendance + '%';
        }

        function calculateTodayAttendance() {
            const today = new Date().toISOString().split('T')[0];
            let count = 0;
            
            Object.values(appData.attendance).forEach(studentAttendance => {
                if (studentAttendance[today] === 'P' || studentAttendance[today] === 'T') {
                    count++;
                }
            });
            
            return count;
        }

        function calculateAverageAttendance() {
            if (appData.students.length === 0) return 0;
            
            let totalPercentage = 0;
            let studentsWithAttendance = 0;
            
            appData.students.forEach(student => {
                const percentage = calculateStudentAttendancePercentage(student.id);
                if (percentage > 0) {
                    totalPercentage += percentage;
                    studentsWithAttendance++;
                }
            });
            
            return studentsWithAttendance > 0 ? Math.round(totalPercentage / studentsWithAttendance) : 0;
        }

        function calculateStudentAttendancePercentage(studentId) {
            const studentAttendance = appData.attendance[studentId];
            if (!studentAttendance) return 0;
            
            const records = Object.values(studentAttendance);
            if (records.length === 0) return 0;
            
            const presentCount = records.filter(status => status === 'P' || status === 'T').length;
            return Math.round((presentCount / records.length) * 100);
        }

        // Classrooms Functions
        function loadClassroomsList() {
            const container = document.getElementById('classroomsList');
            container.innerHTML = '';
            
            if (appData.classrooms.length === 0) {
                container.innerHTML = `
                    <div class="card text-center" style="padding: 3rem;">
                        <h3 style="color: var(--text-muted); margin-bottom: 1rem;">No hay aulas registradas</h3>
                        <p style="color: var(--text-muted); margin-bottom: 2rem;">Comienza creando tu primera aula</p>
                        <button class="btn btn-primary" onclick="showAddClassroom()">+ Crear Primera Aula</button>
                    </div>
                `;
                return;
            }
            
            appData.classrooms.forEach(classroom => {
                const students = appData.students.filter(s => s.classroomId === classroom.id);
                const studentCount = students.length;
                const approvedCount = students.filter(s => s.average >= 7).length;
                const attendancePercentage = calculateClassroomAttendance(classroom.id);
                
                const card = document.createElement('div');
                card.className = 'card mb-3';
                card.innerHTML = `
                    <div class="card-content">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h3 style="margin-bottom: 0.5rem; color: var(--text-primary);">${classroom.name}</h3>
                                <p style="color: var(--text-muted); margin-bottom: 1rem;">${classroom.school} - ${classroom.shift}</p>
                                
                                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <span class="badge badge-info">${studentCount} estudiantes</span>
                                    </div>
                                    <div>
                                        <span class="badge badge-success">${approvedCount} TEA</span>
                                    </div>
                                    <div>
                                        <span class="badge badge-info">${attendancePercentage}% asistencia</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-primary btn-sm" onclick="showClassroomDetail(${classroom.id})">
                                    Ver Detalle
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="startAttendanceForClassroom(${classroom.id})">
                                    Asistencia
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function calculateClassroomAttendance(classroomId) {
            const students = appData.students.filter(s => s.classroomId === classroomId);
            if (students.length === 0) return 0;
            
            let totalPercentage = 0;
            let studentsWithAttendance = 0;
            
            students.forEach(student => {
                const percentage = calculateStudentAttendancePercentage(student.id);
                if (percentage > 0) {
                    totalPercentage += percentage;
                    studentsWithAttendance++;
                }
            });
            
            return studentsWithAttendance > 0 ? Math.round(totalPercentage / studentsWithAttendance) : 0;
        }

        function loadClassroomDetail(classroomId) {
            const classroom = appData.classrooms.find(c => c.id === classroomId);
            if (!classroom) return;
            
            currentClassroom = classroom;
            
            // Update header
            document.getElementById('classroomTitle').textContent = classroom.name;
            document.getElementById('classroomSubtitle').textContent = `${classroom.school} - ${classroom.shift}`;
            
            // Get students for this classroom
            const students = appData.students.filter(s => s.classroomId === classroomId);
            
            // Update stats
            const totalStudents = students.length;
            const approvedStudents = students.filter(s => s.average >= 7).length;
            const attendancePercentage = calculateClassroomAttendance(classroomId);
            const repeaters = students.filter(s => s.isRepeater).length;
            
            document.getElementById('classroomStudentCount').textContent = totalStudents;
            document.getElementById('classroomApproved').textContent = approvedStudents;
            document.getElementById('classroomAttendance').textContent = attendancePercentage + '%';
            document.getElementById('classroomRepeaters').textContent = repeaters;
            
            // Load students table
            loadStudentsTable(students);
        }

        function loadStudentsTable(students) {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';
            
            if (students.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center" style="padding: 2rem; color: var(--text-muted);">
                            No hay estudiantes en esta aula
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort students alphabetically
            const sortedStudents = [...students].sort((a, b) => {
                const lastNameCompare = a.lastName.localeCompare(b.lastName);
                if (lastNameCompare !== 0) return lastNameCompare;
                return a.name.localeCompare(b.name);
            });
            
            sortedStudents.forEach(student => {
                const attendancePercentage = calculateStudentAttendancePercentage(student.id);
                const statusBadge = student.isRepeater ? 
                    '<span class="badge badge-warning">Recursante</span>' : 
                    '<span class="badge badge-success">Regular</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div>
                            <strong>${student.lastName}, ${student.name}</strong>
                        </div>
                    </td>
                    <td>${statusBadge}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 60px; height: 6px; background: var(--border-light); border-radius: 3px; overflow: hidden;">
                                <div style="width: ${attendancePercentage}%; height: 100%; background: var(--success);"></div>
                            </div>
                            <span style="font-size: 0.875rem; color: var(--text-muted);">${attendancePercentage}%</span>
                        </div>
                    </td>
                    <td>
                        <span class="badge ${student.average >= 7 ? 'badge-success' : 'badge-warning'}">
                            ${student.average.toFixed(1)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editStudent(${student.id})">
                            Editar
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Attendance Functions
        function loadAttendanceClassrooms() {
            const container = document.getElementById('attendanceClassroomsList');
            container.innerHTML = '';
            
            if (appData.classrooms.length === 0) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 2rem;">
                        <p style="color: var(--text-muted);">No hay aulas disponibles para tomar asistencia</p>
                    </div>
                `;
                return;
            }
            
            appData.classrooms.forEach(classroom => {
                const students = appData.students.filter(s => s.classroomId === classroom.id);
                const studentCount = students.length;
                
                const item = document.createElement('div');
                item.className = 'menu-item';
                item.onclick = () => startAttendanceForClassroom(classroom.id);
                item.innerHTML = `
                    <div>
                        <div class="menu-title">${classroom.name} - ${classroom.school}</div>
                        <div class="menu-description">${studentCount} estudiantes - ${classroom.shift}</div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        function startAttendanceForClassroom(classroomId) {
            const classroom = appData.classrooms.find(c => c.id === classroomId);
            const students = appData.students.filter(s => s.classroomId === classroomId);
            
            if (students.length === 0) {
                showError('No hay estudiantes en esta aula');
                return;
            }
            
            // Sort students alphabetically
            const sortedStudents = [...students].sort((a, b) => {
                const lastNameCompare = a.lastName.localeCompare(b.lastName);
                if (lastNameCompare !== 0) return lastNameCompare;
                return a.name.localeCompare(b.name);
            });
            
            // Initialize attendance session
            currentAttendanceSession = {
                classroomId: classroomId,
                classroom: classroom,
                students: sortedStudents,
                currentIndex: 0,
                date: new Date().toISOString().split('T')[0],
                records: {}
            };
            
            // Show individual attendance screen
            hideAllSections();
            document.getElementById('individualAttendance').classList.remove('hidden');
            
            // Update UI
            document.getElementById('attendanceInfo').textContent = 
                `${classroom.name} - ${classroom.school} | ${new Date().toLocaleDateString('es-ES')}`;
            
            showCurrentStudent();
        }

        function showCurrentStudent() {
            if (!currentAttendanceSession) return;
            
            const session = currentAttendanceSession;
            const student = session.students[session.currentIndex];
            
            if (!student) {
                finishAttendanceSession();
                return;
            }
            
            // Update UI
            document.getElementById('currentStudentName').textContent = 
                `${student.name} ${student.lastName}`;
            document.getElementById('attendanceProgress').textContent = 
                `${session.currentIndex + 1}/${session.students.length}`;
        }

        function markAttendance(status) {
            if (!currentAttendanceSession) return;
            
            const session = currentAttendanceSession;
            const student = session.students[session.currentIndex];
            
            if (!student) return;
            
            // Record attendance
            session.records[student.id] = status;
            
            // Move to next student
            session.currentIndex++;
            showCurrentStudent();
        }

        function cancelAttendance() {
            if (confirm('¬øEst√° seguro que desea cancelar la toma de asistencia?\n\nSe perder√°n todos los datos ingresados.')) {
                currentAttendanceSession = null;
                showAttendance();
            }
        }

        function finishAttendanceSession() {
            if (!currentAttendanceSession) return;
            
            const session = currentAttendanceSession;
            
            // Save attendance records
            session.students.forEach(student => {
                if (!appData.attendance[student.id]) {
                    appData.attendance[student.id] = {};
                }
                
                appData.attendance[student.id][session.date] = session.records[student.id] || 'A';
            });
            
            // Save data
            saveUserData();
            
            // Calculate results
            const presentCount = Object.values(session.records).filter(s => s === 'P').length;
            const absentCount = Object.values(session.records).filter(s => s === 'A').length;
            const lateCount = Object.values(session.records).filter(s => s === 'T').length;
            
            // Show success message
            showSuccess(`Asistencia guardada exitosamente!\n\nPresentes: ${presentCount}\nAusentes: ${absentCount}\nTardanzas: ${lateCount}`);
            
            // Reset session
            currentAttendanceSession = null;
            
            // Return to attendance section
            showAttendance();
        }

        // Report Functions
        function generateStudentReport() {
            let report = 'REPORTE DE ESTUDIANTES\n';
            report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            appData.classrooms.forEach(classroom => {
                const students = appData.students.filter(s => s.classroomId === classroom.id);
                
                report += `AULA: ${classroom.name} - ${classroom.school}\n`;
                report += `TURNO: ${classroom.shift}\n`;
                report += `TOTAL ESTUDIANTES: ${students.length}\n\n`;
                
                if (students.length > 0) {
                    report += 'ESTUDIANTES:\n';
                    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
                    
                    students.sort((a, b) => {
                        const lastNameCompare = a.lastName.localeCompare(b.lastName);
                        if (lastNameCompare !== 0) return lastNameCompare;
                        return a.name.localeCompare(b.name);
                    }).forEach((student, index) => {
                        const status = student.isRepeater ? ' (R)' : '';
                        report += `${index + 1}. ${student.lastName}, ${student.name}${status} - Promedio: ${student.average}\n`;
                    });
                }
                
                report += '\n';
            });
            
            report += `\nReporte generado: ${new Date().toLocaleString('es-ES')}\n`;
            report += `Usuario: ${currentUser.name}\n`;
            
            downloadReport(report, 'Reporte_Estudiantes.txt');
        }

        function generateAttendanceReport() {
            let report = 'REPORTE DE ASISTENCIA\n';
            report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            appData.classrooms.forEach(classroom => {
                const students = appData.students.filter(s => s.classroomId === classroom.id);
                
                report += `AULA: ${classroom.name} - ${classroom.school}\n`;
                report += `TURNO: ${classroom.shift}\n`;
                report += `TOTAL ESTUDIANTES: ${students.length}\n\n`;
                
                if (students.length > 0) {
                    report += 'ESTAD√çSTICAS DE ASISTENCIA:\n';
                    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
                    
                    students.forEach(student => {
                        const percentage = calculateStudentAttendancePercentage(student.id);
                        report += `${student.lastName}, ${student.name}: ${percentage}%\n`;
                    });
                }
                
                report += '\n';
            });
            
            report += `\nReporte generado: ${new Date().toLocaleString('es-ES')}\n`;
            report += `Usuario: ${currentUser.name}\n`;
            
            downloadReport(report, 'Reporte_Asistencia.txt');
        }

        function generateGradeReport() {
            let report = 'REPORTE DE CALIFICACIONES\n';
            report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            appData.classrooms.forEach(classroom => {
                const students = appData.students.filter(s => s.classroomId === classroom.id);
                
                report += `AULA: ${classroom.name} - ${classroom.school}\n`;
                report += `TURNO: ${classroom.shift}\n`;
                report += `TOTAL ESTUDIANTES: ${students.length}\n`;
                
                if (students.length > 0) {
                    const approvedCount = students.filter(s => s.average >= 7).length;
                    const averageGrade = students.reduce((sum, s) => sum + s.average, 0) / students.length;
                    
                    report += `APROBADOS (‚â•7): ${approvedCount} (${Math.round((approvedCount / students.length) * 100)}%)\n`;
                    report += `PROMEDIO GENERAL: ${averageGrade.toFixed(2)}\n\n`;
                    
                    report += 'DETALLE POR ESTUDIANTE:\n';
                    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
                    
                    students.sort((a, b) => b.average - a.average).forEach((student, index) => {
                        const status = student.average >= 7 ? 'APROBADO' : 'DESAPROBADO';
                        report += `${index + 1}. ${student.lastName}, ${student.name}: ${student.average} (${status})\n`;
                    });
                }
                
                report += '\n';
            });
            
            report += `\nReporte generado: ${new Date().toLocaleString('es-ES')}\n`;
            report += `Usuario: ${currentUser.name}\n`;
            
            downloadReport(report, 'Reporte_Calificaciones.txt');
        }

        function downloadReport(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess('Reporte descargado exitosamente');
        }

        // Utility Functions
        function showError(message) {
            alert('‚ùå Error: ' + message);
        }

        function showSuccess(message) {
            alert('‚úÖ ' + message);
        }

        function showAddClassroom() {
            showError('Funci√≥n de agregar aula en desarrollo');
        }

        function showAddStudent() {
            showError('Funci√≥n de agregar estudiante en desarrollo');
        }

        function editStudent(studentId) {
            showError('Funci√≥n de editar estudiante en desarrollo');
        }

        function showSettings() {
            showError('Configuraci√≥n en desarrollo');
        }

        // Logout
        function logout() {
            if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                // Save data before logout
                saveUserData();
                
                // Reset variables
                currentUser = null;
                currentUserData = null;
                currentClassroom = null;
                currentAttendanceSession = null;
                
                // Show login screen
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Clear form
                document.getElementById('username').value = '';
            }
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (!document.getElementById('loginScreen').classList.contains('hidden')) {
                    return;
                }
                
                if (!document.getElementById('dashboard').classList.contains('hidden')) {
                    logout();
                } else {
                    showDashboard();
                }
            }
        });

        // Enter key support for login
        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginWithUsername();
            }
        });

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('C√°tedra Abierta Suite initialized');
            initializeGoogleAuth();
            
            // Auto-save data every 30 seconds
            setInterval(() => {
                if (currentUser) {
                    saveUserData();
                }
            }, 30000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96978013a07f6ccb',t:'MTc1NDI0MTc4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
